!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("alova")):"function"==typeof define&&define.amd?define(["exports","alova"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AlovaClientHook={},e.alova)}(this,(function(e,t){"use strict";const r="undefined",n=Promise,o=e=>n.resolve(e),s=Object,a=RegExp,i=void 0,c=null,u=!0,l=!1,d=(e,t,r)=>e.then(t,r),f=(e,t)=>e.catch(t),m=(e,t=0)=>setTimeout(e,t),h=e=>s.keys(e),v=(e,t)=>e.forEach(t),p=(e,...t)=>e.push(...t),g=(e,t)=>e.map(t),y=(e,t)=>e.filter(t),S=e=>e.shift(),w=(e,t,r=0,...n)=>e.splice(t,r,...n),b=e=>e.length,E=e=>Array.isArray(e),x=(e,t)=>delete e[t],R=e=>typeof e,_=(e,t)=>e.test(`${t}`),k=(e,t)=>e.includes(t),C=(e,t=l)=>({value:e,writable:t}),M=(e,t,r,n=l)=>s.defineProperty(e,t,n?r:C(r,l));typeof window===r&&typeof process!==r&&process.cwd;const T="memory",j=()=>{},P=e=>e,O=e=>"function"===R(e),H=e=>"number"===R(e)&&!Number.isNaN(e),q=e=>"string"===R(e),D=e=>e!==c&&"object"===R(e),F=e=>s.prototype.toString.call(e),L=e=>"[object Object]"===F(e),U=(e,t)=>e instanceof t,A=e=>e?e.getTime():Date.now(),Q=e=>e.context,$=e=>e.config,N=()=>{const e=(new Date).getTime();return Math.floor(Math.random()*e).toString(36)},z=e=>e.key,W=(e,t,r=[])=>{const n=O(e)?e(...r):e;return t(!!n.key,"hook handler must be a method instance or a function that returns method instance"),n},G=(e,...t)=>s.assign(e,...t),B=(e,...t)=>{const r={};for(const n in e)t.includes(n)||(r[n]=e[n]);return r};function K(){let e,t;return{promise:new Promise(((r,n)=>{e=r,t=n})),resolve:e,reject:t}}const I=e=>{const{cacheFor:t}=$(e);let r=T,n=()=>0,o=l,s=i;const a=O(t);if(!a){let a=t;if(L(t)){const{mode:e=T,expire:n,tag:c}=t||{};r=e,o="restore"===e,s=c?c.toString():i,a=n}n=t=>{return r=O(a)?a({method:e,mode:t}):a,H(r)?A()+r:A(r||i);var r}}return{f:t,c:a,e:n,m:r,s:o,t:s}},V=(e,...t)=>new e(...t),J=(e,t=[])=>O(e)?e(...t):e,X=(e=l)=>{const t=[];let r=i,o=!1;return{addQueue:s=>V(n,((n,a)=>{p(t,(()=>d(s(),n,(t=>{e?n(i):a(t)})))),o||(async()=>{for(o=!0;b(t)>0;){const e=S(t);e&&await e()}r&&r(),o=!1})()})),onComplete:e=>{r=e}}},Y=(e,t,r=u,n,o)=>{const s=()=>{o&&n&&(e=t(e,n,o))!==o[n]&&(o[n]=e)};if(r&&s(),D(e))for(const n in e)U(e,String)||Y(e[n],t,r,n,e);return!r&&s(),e},Z=(e,t)=>{let{startQuiver:r,endQuiver:n}=e;const{delay:o,multiplier:s=1}=e;let a=(o||0)*s**(t-1);return(r||n)&&(r=r||0,n=n||1,a+=a*r+Math.random()*a*(n-r),a=Math.floor(a)),a};class ee extends Error{constructor(e,t,r){super(t+(r?`\n\nFor detailed: https://alova.js.org/error#${r}`:"")),this.name=`[alova${e?`/${e}`:""}]`}}const te=(e="")=>(t,r,n)=>{if(!t)throw V(ee,e,r,n)},re=()=>{const e={};return{eventMap:e,on(t,r){const n=e[t]=e[t]||[];return p(n,r),()=>{e[t]=y(n,(e=>e!==r))}},off(t,r){const n=e[t];if(n)if(r){const e=n.indexOf(r);e>-1&&n.splice(e,1)}else delete e[t]},emit(t,r){const n=e[t]||[];return g(n,(e=>e(r)))}}},ne=(e,t)=>{const r=re(),n=N(),o=e((e=>r.emit(n,e)));return e=>(r.on(n,(r=>{t(e,r)})),o)};class oe{constructor(e,t,r,n){this.s=e,this.k=t,this.$dhy=r,this.$exp=n}get v(){return this.$dhy(this.s)}get e(){return this.$exp(this.s)}}class se extends oe{constructor(e,t,r,n,o){super(e,t,r,n),this.$upd=o}set v(e){this.$upd(this.s,e)}get v(){return super.v}}const ae={authRole:null},ie={authRole:"login"},ce={authRole:"logout"},ue={authRole:"refreshToken"},le=({meta:e},t)=>{if(L(e))for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const n=t[r];if(U(n,RegExp)?n.test(e[r]):e[r]===n)return u}return l},de=(e,t)=>V(n,(r=>{p(t,{method:e,resolve:r})})),fe=(e,t,r,n)=>{if(le(e,(null==t?void 0:t.metaMatches)||r)){return(O(t)?t:L(t)&&O(t.handler)?t.handler:j)(n,e)}},me=async(e,t,r,o,s,a)=>{const c=b(o)>=2;let d=null==s?void 0:s.isExpired(...o);if(U(d,n)&&(d=await d),d)try{let n=u;if(c&&a&&(n=l,await de(e,t)),n&&(r(u),await(null==s?void 0:s.handler(...o)),r(l),v(t,(({resolve:e})=>e()))),c){const{config:t}=e,r=t.transform;t.transform=i;const n=await e;return t.transform=r,n}}finally{r(l),w(t,0,b(t))}},he=e=>{let t=i,r=i,n=i;if(O(e))t=e;else if(L(e)){const{onSuccess:o,onError:s,onComplete:a}=e;t=O(o)?o:t,r=O(s)?s:r,n=O(a)?a:n}return{onSuccess:t,onError:r,onComplete:n}},ve=e=>{throw e};const pe=(e,t)=>{let r=c;return function(...n){const o=e.bind(this,...n),s=H(t)?t:t(...n);r&&(e=>{clearTimeout(e)})(r),s>0?r=m(o,s):o()}},ge=(e,r=[])=>{const n=O(e)?e(...r):e;return te("scene")(U(n,t.Method),"hook handler must be a method instance or a function that returns method instance"),n};var ye;function Se(e,t={trackedKeys:{},bindError:l}){const r=t=>e.ref?e.ref(t):{current:t};t=r(t).current;const n=r=>(e.export||P)(r,t),o=t=>{if(!O(e.memorize))return t;const r=e.memorize(t);return r.memorized=!0,r},{dehydrate:a}=e,i=(r,n,o)=>r!==a(n,o,t)&&t.trackedKeys[o]&&e.update(r,n,o,t),c=e=>g(e,(e=>U(e,oe)?e.e:e)),d=[],f={};return{create:(r,o)=>(p(d,o),V(se,e.create(r,o,t),o,(e=>a(e,o,t)),n,((e,t)=>i(t,e,o)))),computed:(r,o,s)=>(v(o,(e=>{e.k&&(f[e.k]=!0)})),V(oe,e.computed(r,c(o),s,t),s,(e=>a(e,s,t)),n)),effectRequest:r=>e.effectRequest(r,t),ref:r,watch:(r,n)=>e.watch(c(r),n,t),onMounted:r=>e.onMounted(r,t),onUnmounted:r=>e.onUnmounted(r,t),memorize:o,__referingObj:t,exposeProvider:e=>{const r={},n={};for(const a in e){const i=e[a];if(O(i)&&!t.trackedKeys[a])r[a]=a.startsWith("on")?(...e)=>(i(...e),v):i.memorized?i:o(i);else{const e=U(i,oe);e&&(n[a]=i.s),s.defineProperty(r,a,{get:()=>(t.trackedKeys[a]=u,e?i.e:i),set:j,enumerable:u,configurable:u})}}const{update:a,__proxyState:c}=r;t.trackedKeys={...f},t.bindError=l;const m={__referingObj:t,update:o((e=>{h(e).forEach((t=>{k(d,t)?i(e[t],n[t],t):t in r&&O(a)&&a({[t]:e[t]})}))})),__proxyState:o((r=>k(d,r)&&U(e[r],oe)?(t.trackedKeys[r]=u,e[r]):c(r)))},v=G(r,m);return v},objectify:(e,t)=>e.reduce(((e,r)=>(e[r.k]=t?r[t]:r,e)),{}),transformState2Proxy:(e,r)=>V(se,e,r,(e=>a(e,r,t)),n,((e,t)=>i(t,e,r)))}}!function(e){e[e.USE_REQUEST=1]="USE_REQUEST",e[e.USE_WATCHER=2]="USE_WATCHER",e[e.USE_FETCHER=3]="USE_FETCHER"}(ye||(ye={}));const we=te(""),be=te("useRequest"),Ee=te("useWatcher"),xe=te("useFetcher"),Re=e=>({[ye.USE_REQUEST]:be,[ye.USE_WATCHER]:Ee,[ye.USE_FETCHER]:xe}[e]),_e=(e,r)=>e(U(r,t.Method),"expected a method instance."),ke="success",Ce="error",Me="complete";class Te{constructor(e,t){this.method=e,this.args=t}clone(){return{...this}}static spawn(e,t){return new Te(e,t)}}class je extends Te{constructor(e,t,r){super(e.method,e.args),this.data=t,this.fromCache=r}}class Pe extends Te{constructor(e,t){super(e.method,e.args),this.error=t}}class Oe extends Te{constructor(e,t,r,n,o){super(e.method,e.args),this.status=t,this.data=r,this.fromCache="error"!==t&&n,this.error=o}}class He extends Te{constructor(e,t){super(e.method,e.args),this.eventSource=t}}class qe extends He{constructor(e,t){super(e,e.eventSource),this.error=t}}class De extends He{constructor(e,t){super(e,e.eventSource),this.data=t}}class Fe{constructor(e,t,r){this.behavior=e,this.method=t,this.silentMethod=r}}class Le extends Fe{constructor(e,t,r,n,o){super(e,t,r),this.queueName=n,this.retryTimes=o}}class Ue extends Le{constructor(e,t,r,n,o,s,a){super(e,t,r,n,o),this.data=s,this.vDataResponse=a}}class Ae extends Le{constructor(e,t,r,n,o,s,a){super(e,t,r,n,o),this.error=s,this.retryDelay=a}}class Qe extends Le{constructor(e,t,r,n,o,s){super(e,t,r,n,o),this.error=s}}class $e extends Fe{constructor(e,t,r,n){super(e,t,r),this.args=n}}class Ne extends $e{constructor(e,t,r,n,o){super(e,t,r,n),this.data=o}}class ze extends $e{constructor(e,t,r,n,o){super(e,t,r,n),this.error=o}}class We extends $e{constructor(e,t,r,n,o,s){super(e,t,r,n),this.retryTimes=o,this.retryDelay=s}}class Ge extends $e{constructor(e,t,r,n,o,s,a){super(e,t,r,n),this.status=o,this.data=s,this.error=a}}class Be extends Te{constructor(e,t,r){super(e.method,e.args),this.retryTimes=t,this.retryDelay=r}}class Ke extends Pe{constructor(e,t,r){super(e,t),this.retryTimes=r}}const Ie=(e,t)=>t(),Ve={},Je=(e,t)=>(Ve[e]||{})[t]||{};function Xe(e,r,n=[]){const s=Re(e.ht);let a=W(r,s,n);const{fs:c,ht:f,c:m,ms:h}=e,{loading:v,data:g,error:y}=c,S=f===ye.USE_FETCHER,{force:w=l,middleware:b=Ie}=m,E=Q(a),{id:R}=E,_=z(a),{abortLast:k=u}=m,C=!e.m;return e.m=a,(async()=>{let E=j,M=j,T=l,P=o(i),O=j,H=j;const q=await t.queryCache(a);let D=()=>!!q,F=l;S||(M=t=>((e,t,r,n)=>{(Ve[e]=Ve[e]||{})[t]={s:r,h:n}})(R,_,t,e),M({...c,...h}),E=()=>((e,t)=>{const r=Ve[e];r&&x(r,t)})(R,_));const L=t=>{T=u;const{force:r=w,method:o=a}=t||{},s=J(r,[V(Te,a,n)]),i=e=>({loaded:t,total:r})=>{c[e].v={loaded:t,total:r}};a=o,p(e.sf,M),p(e.rf,E),F||(v.v=!!s||!q);const{downloading:d,uploading:f}=e.ro.trackedKeys;return O=d?a.onDownload(i("downloading")):O,H=f?a.onUpload(i("uploading")):H,P=a.send(s),D=()=>a.fromCache||l,P},U={method:a,cachedResponse:q,config:m,abort:()=>a.abort()},A=()=>f!==ye.USE_WATCHER||!k||e.m===a,Q=(e=u)=>{e&&C&&(v.v=l),F=e},$=b(S?{...U,args:n,fetch:(t,...r)=>(_e(s,t),Xe(e,t,r)),proxyStates:B(c,"data"),controlLoading:Q}:{...U,args:n,send:(...t)=>Xe(e,r,t),proxyStates:c,controlLoading:Q},L);let N=i;const z=Te.spawn(a,n);try{const t=await $,r=t=>{if(S){if(e.c.updateState!==l){const e=Je(R,_).s;e&&(e.data.v=t)}}else A()&&(g.v=t);return A()&&(y.v=i,!F&&(v.v=l),e.em.emit(ke,V(je,z,t,D())),e.em.emit(Me,V(Oe,z,ke,t,D(),i))),t};N=t!==i?r(t):T?await d(P,r,(()=>r(i))):i,!T&&!F&&(v.v=l)}catch(t){throw A()&&(y.v=t,!F&&(v.v=l),e.em.emit(Ce,V(Pe,z,t)),e.em.emit(Me,V(Oe,z,Ce,i,D(),t))),t}return O(),H(),N})()}const Ye=e=>e.current;function Ze(e,r,o,s,a=l,c,d=0){var h;o={...o};const{__referingObj:p={trackedKeys:{},bindError:l}}=o;let g=!!a;if(a)try{const t=W(r,Re(e)),s=Q(t),a=s.l1Cache.get((y=s.id,S=z(t),"$a."+y+S));let c=i;if(a&&!U(a,n)){const[e,t]=a;(!t||t>A())&&(c=e)}g=!!J(null!==(h=o.force)&&void 0!==h?h:l)||!c}catch(e){}var y,S;const{create:w,effectRequest:b,ref:x,objectify:R,exposeProvider:_,transformState2Proxy:k}=Se(t.promiseStatesHook(),p),C={total:0,loaded:0},{managedStates:M={}}=o,T=((e,t)=>{const r={};for(const n in e)r[n]=t(e[n],n,e);return r})(M,((e,t)=>k(e,t))),j=w(O(s)?s():s,"data"),P=w(g,"loading"),q=w(i,"error"),D=w({...C},"downloading"),F=w({...C},"uploading"),L=R([j,P,q,D,F]),$=re(),N=Ye(x(((e,t,r,n)=>({m:i,sf:[],rf:[],fs:{},em:r,ht:e,c:t,ro:n,ms:{}}))(e,o,$,p)));N.fs=L,N.em=$,N.c=o,N.ms=T;const G=c!==i,B=(e=r,t)=>Xe(N,e,t),K=Ye(x(((e=0)=>{let t=i;return r=>{t&&clearTimeout(t),t=m(r,e)}})())),I=(e=p,t)=>{K((()=>{f(B(t),(t=>{if(!e.bindError&&!e.trackedKeys.error)throw t}))}))},V=x(pe(((e,t,r)=>I(t,r)),(e=>H(e)?E(d)?d[e]:d:0)));return t.globalConfigMap.ssr||b({handler:G?e=>V.current(e,p,r):()=>I(p),removeStates:()=>v(N.rf,(e=>e())),saveStates:e=>v(N.sf,(t=>t(e))),frontStates:{...L,...T},watchingStates:c,immediate:null!=a?a:u}),_({...R([j,P,q,D,F]),abort:()=>N.m&&N.m.abort(),send:(e,t)=>B(t,e),onSuccess(e){$.on(ke,e)},onError(e){p.bindError=u,$.on(Ce,e)},onComplete(e){$.on(Me,e)}})}function et(e={}){const t=Ze(ye.USE_FETCHER,j,e),{send:r}=t;return x(t,"send"),G(t,{fetch:(e,...t)=>(_e(xe,e),r(t,e))})}function tt(e,t={}){const{immediate:r=u,initialData:n}=t,o=Ze(ye.USE_REQUEST,e,t,n,!!r),{send:s}=o;return G(o,{send:(...e)=>s(e)})}function rt(e,t,r={}){Ee(t&&b(t)>0,"expected at least one watching state");const{immediate:n,debounce:o=0,initialData:s}=r,a=Ze(ye.USE_WATCHER,e,r,s,!!n,t,o),{send:i}=a;return G(a,{send:(...e)=>i(e)})}const nt=te("usePagination"),ot=(e,t)=>nt(H(e)&&e<b(t),"index must be a number that less than list length");const st=(e,t)=>te(e)(E(t)&&b(t)>0,"please use an array to represent serial requests"),at=(e,t,r=[])=>(e.shift(),(n,s)=>{null==t||t(n,(()=>o(i))),n.controlLoading();const a=n.proxyStates.loading;a.v=u;let c=s();for(const t of e)c=d(c,(e=>{const o=t(e,...n.args);return p(r,o),o.send()}));return c.finally((()=>{a.v=l}))});const it="valueOf",ct="default",ut="silent";let lt;const dt=e=>{lt=e};let ft;let mt={};let ht=0;const vt=e=>{ht=e};let pt=[];const gt=Symbol("GlobalSQBoot"),yt=Symbol("GlobalSQBefore"),St=Symbol("GlobalSQSuccess"),wt=Symbol("GlobalSQError"),bt=Symbol("GlobalSQFail"),Et=re(),xt=te("useSQRequest");async function Rt(e,r){let n=l;if(e){const{update:o}=t.promiseStatesHook(),s=z(e),{id:a}=Q(e),{s:c,h:l}=Je(a,s),d=O(r)?{data:r}:r;let f=i;c&&(v(h(d),(e=>{we(e in c,`state named \`${e}\` is not found`);const t=c[e];let r=d[e](t.v);r=E(r)?[...r]:D(r)?{...r}:r,"data"===e&&(f=r),o(r,c[e].s,e,l.ro)})),n=u),f!==i&&t.setCache(e,f)}return n}var _t={forward:e=>U(e,Date)?e.getTime():i,backward:e=>V(Date,e)},kt={forward:e=>U(e,RegExp)?e.source:void 0,backward:e=>V(RegExp,e)};const Ct=(e={})=>{const t={date:_t,regexp:kt,...e};return{serialize:e=>(D(e)&&(e=Y(E(e)?[...e]:{...e},(e=>{let r=i;const n=h(t).reduce(((e,n)=>{if(!r){const o=t[n].forward(e);o!==i&&(r=n,e=o)}return e}),e);return"[object Object]"===s.prototype.toString.call(e)?e={...e}:E(e)&&(e=[...e]),r!==i?[r,n]:e}))),e),deserialize:e=>D(e)?Y(e,(e=>{if(E(e)&&2===b(e)){const r=t[e[0]];e=r?r.backward(e[1]):e}return e}),l):e}},Mt=Symbol("vdid"),Tt=Symbol("original"),jt=/\[vd:([0-9a-z]+)\]/,Pt=e=>{const t=null==e?void 0:e[Mt];t&&lt&&(lt[t]=i)},Ot=(e,t=u)=>{Pt(e);const r=null==e?void 0:e[Mt];return(r?`[vd:${r}]`:i)||(t?e:i)};function Ht(){return Ot(this)}const qt=function(){};qt.prototype=s.create(c,{[it]:C(Ht)});const Dt=function(){};Dt.prototype=s.create(c,{[it]:C(Ht)});var Ft=(e,t=N())=>{const r=(e,t=N())=>{if(e===c)e=V(qt);else if(e===i)e=V(Dt);else{const t=s(e);M(t,it,Ht),M(t,Tt,e),e=t}return M(e,Mt,t),e},n=r(e,t);return(L(n)||E(n))&&Y(n,(e=>r(e))),n};const Lt=(e,t=u)=>{const r=e=>(Pt(e),(null==e?void 0:e[Mt])&&(U(e,Dt)?e=i:U(e,qt)?e=c:(U(e,Number)||U(e,String)||U(e,Boolean))&&(e=e[Tt])),e),n=r(e);return t&&(D(n)||E(n))&&Y(n,(e=>r(e))),n};const Ut="__$k",At="__$v",Qt=()=>(xt(!!ft,"alova instance is not found, Do you forget to set `alova` or call `bootSilentFactory`?"),ft.l2Cache);let $t=i;const Nt="alova.SQ",zt="alova.SM.",Wt=async(e,t)=>{const r=Qt();D(t)&&(t=Y(E(t)?[...t]:{...t},((e,t,r)=>{var n;if(t===At&&r[Ut])return e;if("context"===t&&"Alova"===(null===(n=null==e?void 0:e.constructor)||void 0===n?void 0:n.name))return i;const o=null==e?void 0:e[Mt];let s=Lt(e,l);if("[object Object]"===F(s)?(e={...e},s={}):E(e)&&(e=[...e],s=[]),o){const t={[Ut]:o,[At]:s,...e};if(U(e,String))for(let r=0;r<b(e);r+=1)null==t||delete t[r];e=t}return e}))),$t=$t||Ct(mt),await r.set(e,$t.serialize(t))},Gt=async e=>{const t=await Qt().get(e);return $t=$t||Ct(mt),D(t)?Y($t.deserialize(t),(e=>{if(D(e)&&(null==e?void 0:e[Ut])){const t=e[Ut],r=Ft(e[At],t);v(h(e),(t=>{k([Ut,At],t)||(r[t]=e[t])})),e=r}return e}),l):t},Bt=async e=>{await Qt().remove(e)},Kt=e=>Wt(zt+e.id,e),It=async(e,t,r)=>{const n=await Gt(Nt)||{},o=n[e]||[],s=o.findIndex((e=>e===t));s>=0&&(r?(w(o,s,1,r.id),await Kt(r)):w(o,s,1),await Bt(zt+t),b(o)<=0&&delete n[e],b(h(n))>0?await Wt(Nt,n):await Bt(Nt))};let Vt={};const Jt=(e,t)=>{const r=e=>{const r=Ot(e);return r in t?t[r]:q(e)?e.replace(V(a,jt.source,"g"),(e=>e in t?t[e]:e)):e};return D(e)&&!Ot(e,l)?Y(e,r):e=r(e),e},Xt=(e,t)=>{let r={};const n=Ot(e,l);if(n&&(r[n]=t),D(e))for(const n in e)r={...r,...Xt(e[n],null==t?void 0:t[n])};return r},Yt=(e,t)=>{t?e.active=t:delete e.active},Zt=1e3,er=(e,r)=>{const o=t=>{const r=e[0];if(r){const n=pt.find((({queue:e})=>U(e,a)?_(e,t):e===t)),o=()=>e[0]&&s(e[0]),i=(null==n?void 0:n.wait)?J(n.wait,[r,t]):0;i&&i>0?m(o,i):o()}},s=(a,i=0)=>{Yt(a,u);const{cache:c,id:f,behavior:h,entity:p,retryError:y=/.*/,maxRetryTimes:w=0,backoff:E={delay:Zt},resolveHandler:x=j,rejectHandler:R=j,emitter:k,handlerArgs:C=[],virtualResponse:M,force:T}=a;Et.emit(yt,V(Le,h,p,a,r,i)),d(p.send(T),(async s=>{if(S(e),c&&await It(r,f),x(s),h===ut){const o=Xt(M,s),{targetRefMethod:c,updateStates:u}=a;if(U(c,t.Method)&&u&&b(u)>0){const e={};v(u,(t=>{e[t]=e=>Jt(e,o)}));Rt(c,e)||await t.setCache(c,(e=>Jt(e,o)))}await((e,t)=>n.all(g(t,(async t=>{Jt(t.entity,e),t.cache&&await Kt(t)}))))(o,e),Et.emit(St,V(Ue,h,p,a,r,i,s,o))}Yt(a,l),o(r)}),(t=>{if(h!==ut)S(e),R(t);else{const e=e=>Et.emit(wt,V(Ae,h,p,a,r,i,t,e)),{name:n="",message:o=""}=t||{};let c,u;U(y,RegExp)?u=y:D(y)&&(c=y.name,u=y.message);const l=c&&_(c,n)||u&&_(u,o);if(i<w&&l){const t=Z(E,i+1);e(t),m((()=>{s(a,i+=1),k.emit("retry",V(We,h,p,a,C,i,t))}),t)}else vt(2),e(),k.emit("fallback",V(ze,h,p,a,C,t)),Et.emit(bt,V(Qe,h,p,a,r,i,t))}Yt(a,l)}))};o(r)},tr=async(e,t,r=ct,n=()=>[])=>{e.cache=t;const o=Vt[r]=Vt[r]||[],s=b(o)<=0,a=!(await Promise.all(n())).some((e=>e===l));return a&&(t&&await(async(e,t)=>{await Kt(e);const r=await Gt(Nt)||{},n=r[t]=r[t]||[];p(n,e.id),await Wt(Nt,r)})(e,r),p(o,e),s&&1===ht&&er(o,r)),a},rr=e=>{let t=i,r="",n=0;for(const o in Vt)if(n=Vt[o].indexOf(e),n>=0){t=Vt[o],r=o;break}return[t,r,n]};class nr{constructor(e,t,r,n=N(),o,s,a,i,c,u,l,d){const f=this;f.entity=e,f.behavior=t,f.id=n,f.emitter=r,f.force=!!o,f.retryError=s,f.maxRetryTimes=a,f.backoff=i,f.resolveHandler=c,f.rejectHandler=u,f.handlerArgs=l,f.vDatas=d}async save(){this.cache&&await Kt(this)}async replace(e){const t=this;xt(e.cache===t.cache,"the cache of new silentMethod must equal with this silentMethod");const[r,n,o]=rr(t);r&&(w(r,o,1,e),t.cache&&await It(n,t.id,e))}async remove(){const e=this,[t,r,n]=rr(e);t&&(w(t,n,1),e.cache&&await It(r,e.id))}setUpdateState(e,t="data"){e&&(this.targetRefMethod=e,this.updateStates=E(t)?t:[t])}}var or=async()=>{const e=await Gt(Nt)||{},r={},o=[];return v(h(e),(n=>{const s=r[n]=r[n]||[];p(o,...g(e[n],(async e=>{const r=await Gt(zt+e);r&&p(s,(e=>{const{id:r,behavior:n,entity:o,retryError:s,maxRetryTimes:a,backoff:i,resolveHandler:c,rejectHandler:l,handlerArgs:d,targetRefMethod:f,force:m}=e,p=e=>{const{type:r,url:n,config:o,data:s}=e;return V(t.Method,r,ft,n,o,s)},g=V(nr,p(o),n,re(),r,m,s,a,i,c,l,d);return g.cache=u,f&&(g.targetRefMethod=p(f)),v(h(e),(t=>{k(["id","behavior","emitter","entity","retryError","maxRetryTimes","backoff","resolveHandler","rejectHandler","handlerArgs","targetRefMethod","force"],t)||(g[t]=e[t])})),g})(r))})))})),await n.all(o),r};let sr=i;var ar=(e,t)=>{const{behavior:r="queue",queue:s=ct,retryError:a,maxRetryTimes:c,backoff:f}=t||{},m=re();let v,p,g,y=ct,S=l;return{c:(...t)=>(xt(O(e),"method handler must be a function. eg. useSQRequest(() => method)"),dt({}),v=t,e(...t)),m:({method:e,args:t,cachedResponse:w,proxyStates:E,config:x},R)=>{const{silentDefaultResponse:k,vDataCaptured:C,force:M=l}=x,T=Te.spawn(e,t);p=J(r,[T]),y=J(s,[T]),S=J(M,[T]);const j=()=>{dt(v=i)};if(O(C)){let t=lt&&b(h(lt))>0;if(!t){const{url:r,data:n}=e,{params:o,headers:s}=$(e);Y({url:r,params:o,data:n,headers:s},(e=>(t||!Ot(e,l)&&!_(jt,e)||(t=u),e)))}const r=t?C(e):i;if(r!==i)return j(),o(r)}if("static"!==p){const r=()=>{const r=V(n,((t,r)=>{g=V(nr,e,p,m,i,!!S,a,c,f,t,r,v,lt&&h(lt)),j()}));return d(o(i),(async()=>{const r=()=>V($e,p,e,g,t);await tr(g,b(m.eventMap.fallback||[])<=0&&p===ut,y,(()=>m.emit("beforePushQueue",r())))&&m.emit("pushedQueue",r())})),r};if("queue"===p){const e=S||!w;return e&&(E.loading.v=u),e?r():d(o(w))}const s=r(),l=g.virtualResponse=Ft(O(k)?k():i);return d(s,(e=>{E.data.v=e})),o(l)}return j(),R()},d:e=>{e.onSuccess=ne(e.onSuccess,((e,t)=>{sr=g,e(V(Ne,p,t.method,g,t.args,t.data))})),e.onError=ne(e.onError,((e,t)=>{e(V(ze,p,t.method,g,t.args,t.error))})),e.onComplete=ne(e.onComplete,((e,t)=>{e(V(Ge,p,t.method,g,t.args,t.status,t.data,t.error))}))},b:{onFallback:e=>{m.on("fallback",e)},onBeforePushQueue:e=>{m.on("beforePushQueue",e)},onPushedQueue:e=>{m.on("pushedQueue",e)},onRetry:e=>{m.on("retry",e)}}}};const ir=async(e,t=ct,r=l)=>{const n=(t=[])=>t.filter((t=>{if(e===i)return u;const n=$(t.entity).name||"";return(U(e,RegExp)?_(e,n):n===e)&&(r?t.active:u)}));return[...n(Vt[t]),...0===ht?n((await or())[t]):[]]};const cr=(e,r={})=>{let n=u;const{enableFocus:o=u,enableVisibility:s=u,enableNetwork:a=u,pollingTime:i=0,throttle:c=1e3}=r,{onMounted:d,onUnmounted:f,__referingObj:m}=Se(t.promiseStatesHook()),h=tt(e,{...r,__referingObj:m}),v=()=>{n&&(h.send(),c>0&&(n=l,setTimeout((()=>{n=u}),c)))};let p=j,g=j,y=j,S=j;return d((()=>{t.globalConfigMap.ssr||(p=a?cr.onNetwork(v,r):p,g=o?cr.onFocus(v,r):g,y=s?cr.onVisibility(v,r):y,S=i>0?cr.onPolling(v,r):S)})),f((()=>{p(),g(),y(),S()})),h},ur=(e,t)=>(window.addEventListener(e,t),()=>window.removeEventListener(e,t));cr.onNetwork=e=>ur("online",e),cr.onFocus=e=>ur("focus",e),cr.onVisibility=e=>ur("visibilitychange",(()=>"visible"===document.visibilityState&&e())),cr.onPolling=(e,t)=>{const r=setInterval(e,t.pollingTime);return()=>clearInterval(r)};const lr="useCaptcha",dr=te(lr);const fr=Symbol("FormRestore"),mr={},hr=e=>{const t=e=>E(e)?[...e]:L(e)?{...e}:e;return Y(t(e),t)};const vr=Symbol("RetriableRetry"),pr=Symbol("RetriableFail"),gr="useRetriableRequest",yr=te(gr);const Sr=Symbol("SSEOpen"),wr=Symbol("SSEMessage"),br=Symbol("SSEError");var Er;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=2]="CLOSED"}(Er||(Er={}));const xr=te("useSSE"),Rr="open",_r="error",kr="message";const Cr={},Mr=te("subscriber");e.accessAction=(e,t,r=!1)=>{const n=[];"symbol"==typeof e||q(e)||H(e)?Cr[e]&&p(n,...Cr[e]):U(e,RegExp)&&v(y(h(Cr),(t=>e.test(t))),(e=>{p(n,...Cr[e])})),0!==n.length||r||Mr(!1,`no handler can be matched by using \`${e.toString()}\``),v(n,t)},e.actionDelegationMiddleware=e=>{const{ref:r}=Se(t.promiseStatesHook()),n=r(l);return(t,r)=>{if(!n.current){const{abort:r,proxyStates:o,delegatingActions:s={}}=t,a=e=>{for(const t in e)o[t]&&(o[t].v=e[t])};(Cr[e]=Cr[e]||[]).push((e=>!!e.send)(t)?{...s,send:t.send,abort:r,update:a}:{...s,fetch:t.fetch,abort:r,update:a}),n.current=u}return r()}},e.bootSilentFactory=e=>{if(0===ht){const{alova:t,delay:r=500}=e;ft=t,((e={})=>{mt=e})(e.serializers),((e=0)=>{pt=E(e)?e:[{queue:ct,wait:e}]})(e.requestWait),m((async()=>{var e;e=await or(),v(h(e),(t=>{const r=Vt[t]=Vt[t]||[];p(r,...e[t])})),v(h(Vt),(e=>{er(Vt[e],e)})),vt(1),Et.emit(gt,i)}),r)}},e.createClientTokenAuthentication=({visitorMeta:e,login:t,logout:r,refreshToken:n,assignToken:o=j})=>{let s=l;const a=[];return{waitingList:a,onAuthRequired:r=>async i=>{const c=le(i,e||ae),u=le(i,(null==t?void 0:t.metaMatches)||ie);return c||u||le(i,(null==n?void 0:n.metaMatches)||ue)||(s&&await de(i,a),await me(i,a,(e=>{s=e}),[i],n)),c||u||await o(i),null==r?void 0:r(i)},onResponseRefreshToken:e=>{const n=he(e);return{...n,onSuccess:async(e,o)=>(await fe(o,t,ie,e),await fe(o,r,ce,e),(n.onSuccess||P)(e,o))}}}},e.createServerTokenAuthentication=({visitorMeta:e,login:t,logout:r,refreshTokenOnSuccess:n,refreshTokenOnError:o,assignToken:s=j})=>{let a=l;const i=[];return{waitingList:i,onAuthRequired:r=>async c=>{const u=le(c,e||ae),l=le(c,(null==t?void 0:t.metaMatches)||ie);return u||l||le(c,(null==n?void 0:n.metaMatches)||ue)||le(c,(null==o?void 0:o.metaMatches)||ue)||a&&await de(c,i),u||l||await s(c),null==r?void 0:r(c)},onResponseRefreshToken:s=>{const c=he(s);return{...c,onSuccess:async(o,s)=>{if(!le(s,e||ae)&&!le(s,(null==t?void 0:t.metaMatches)||ie)&&!le(s,(null==n?void 0:n.metaMatches)||ue)){const e=await me(s,i,(e=>{a=e}),[o,s],n,a);if(e)return e}return await fe(s,t,ie,o),await fe(s,r,ce,o),(c.onSuccess||P)(o,s)},onError:async(r,n)=>{if(!le(n,e||ae)&&!le(n,(null==t?void 0:t.metaMatches)||ie)&&!le(n,(null==o?void 0:o.metaMatches)||ue)){const e=await me(n,i,(e=>{a=e}),[r,n],o,a);if(e)return e}return(c.onError||j)(r,n)}}}}},e.dehydrateVData=e=>Lt(e),e.equals=(e,t)=>e===t?u:Ot(e)===Ot(t),e.filterSilentMethods=ir,e.getSilentMethod=async(e,t=ct,r=l)=>(await ir(e,t,r))[0],e.isVData=e=>!!Ot(e,l)||_(jt,e),e.onBeforeSilentSubmit=e=>Et.on(yt,e),e.onSilentSubmitBoot=e=>Et.on(gt,e),e.onSilentSubmitError=e=>Et.on(wt,e),e.onSilentSubmitFail=e=>Et.on(bt,e),e.onSilentSubmitSuccess=e=>Et.on(St,e),e.silentQueueMap=Vt,e.statesHookHelper=Se,e.stringifyVData=Ot,e.updateState=Rt,e.updateStateEffect=async(e,t)=>(sr&&(sr.setUpdateState(e,O(Rt)?i:h(Rt)),await sr.save()),Rt(e,t)),e.useAutoRequest=cr,e.useCaptcha=(e,r={})=>{const{initialCountdown:o,middleware:s}=r;dr(o===i||o>0,"initialCountdown must be greater than 0");const{create:a,ref:c,objectify:u,exposeProvider:d,__referingObj:f}=Se(t.promiseStatesHook()),m=a(0,"countdown"),h=tt(e,{...r,__referingObj:f,immediate:l,managedStates:u([m],"s"),middleware:s?(e,t)=>s({...e,send:p},t):i}),v=c(i),p=(...e)=>V(n,((t,n)=>{m.v<=0?h.send(...e).then((e=>{m.v=r.initialCountdown||60,v.current=setInterval((()=>{m.v-=1,m.v<=0&&clearInterval(v.current)}),1e3),t(e)})).catch((e=>n(e))):n(V(ee,lr,"the countdown is not over yet"))}));return d({...h,send:p,...u([m])})},e.useFetcher=et,e.useForm=(e,r={})=>{const n=mr,{id:o,initialForm:s,store:a,resetAfterSubmiting:c,immediate:d=l,middleware:f}=r;t.promiseStatesHook();const{create:m,ref:h,onMounted:v,watch:p,objectify:g,exposeProvider:y,__referingObj:S}=Se(t.promiseStatesHook()),w=L(a),b=w?a.enable:a,E=o?n[o]:i,x=m(hr(s),"form"),R=e,_=re(),k=h(J(R,[x.v])),C=Q(k.current).l2Cache,M=((e,t)=>`alova/form-${t||z(e)}`)(k.current,o),T=h(l),j=h(Ct(w?a.serializers:i)),P=h(!1),O=tt(((...e)=>R(x.v,...e)),{...r,__referingObj:S,middleware:f?(e,t)=>f({...e,delegatingActions:{updateForm:q,reset:H}},t):i,immediate:b||E?l:d}),H=()=>{T.current=u;const e=hr(s);e&&(x.v=e),b&&C.remove(M)},q=e=>{x.v={...x.v,...e}},D=y({...O,...g([x]),updateForm:q,reset:H,onRestore(e){_.on(fr,e)}});o&&(E||(P.current=u),P.current&&(n[o]={hookProvider:D,config:r}));const{send:F,onSuccess:U}=D;return v((()=>{if(b&&!E){const e=j.current.deserialize(C.get(M));e&&(x.v=e,_.emit(fr,i)),b&&d&&F()}})),p([x],(()=>{!T.current&&b?C.set(M,j.current.serialize(x.v)):T.current=l})),U((()=>{c&&H()})),E&&!P.current?E.hookProvider:D},e.usePagination=(e,r={})=>{const{create:n,computed:a,ref:c,watch:d,exposeProvider:m,objectify:S,__referingObj:x}=Se(t.promiseStatesHook()),{preloadPreviousPage:R=u,preloadNextPage:_=u,total:C=e=>e.total,data:M=e=>e.data,append:P=l,initialPage:q=1,initialPageSize:D=10,watchingStates:F=[],initialData:L,immediate:Q=u,middleware:$=j,force:N=j,...W}=r,G=c(e),B=c(l),V=n(q,"page"),J=n(D,"pageSize"),Y=n(L&&M(L)||[],"data"),Z=n(L?C(L):i,"total"),{snapshots:ee,get:te,save:re,remove:ne}=c((e=>{let r={};return{snapshots:()=>r,save(e,t=l){const n=z(e);r[n]&&!t||(r[n]={entity:e})},get:n=>r[z(U(n,t.Method)?n:e(n))],remove(e){e?delete r[e]:r={}}}})((e=>G.current(e,J.v)))).current,oe=e=>M(e)||e,se=et({__referingObj:x,updateState:l,force:({args:e})=>e[0]}),{loading:ae,fetch:ie,abort:ce,onSuccess:ue}=se,le=c(ae),de=(t=V.v)=>{const r=J.v,n=e(t,r);return re(n),n};d(F,(()=>{V.v=q,B.current=u}));const fe=c({}),me=a((()=>{const e=Z.v;return e!==i?Math.ceil(e/J.v):i}),[J,Z],"pageCount"),he=e=>(...t)=>fe.current[e](...t),ve=rt(de,[...F,V.e,J.e],{__referingObj:x,immediate:Q,initialData:L,managedStates:S([Y,V,J,Z],"s"),middleware:(e,t)=>($({...e,delegatingActions:{refresh:he("refresh"),insert:he("insert"),remove:he("remove"),replace:he("replace"),reload:he("reload"),getState:e=>({page:V,pageSize:J,data:Y,pageCount:me,total:Z,isLastPage:be}[e].v)}},o),t()),force:e=>e.args[1]||(O(N)?N(e):N),...W}),{send:pe}=ve,ge=ve.__proxyState("data"),ye=async e=>{const{rawData:r=ge.v,preloadPage:n,fetchMethod:o,forceRequest:s=l,isNextPage:a=l}=e,{e:i}=I(o);if(i(T)<=A())return l;if(s)return u;if(await t.queryCache(o))return l;const c=me.v,d=c?n>c:a?b(oe(r))<J.v:l;return n>0&&!d},we=async(e,t=l)=>{const r=V.v+1,n=de(r);_&&await ye({rawData:e,preloadPage:r,fetchMethod:n,isNextPage:u,forceRequest:t})&&f(ie(n,t),j)},be=a((()=>{const e=ge.v;if(!e)return u;const t=oe(e),r=V.v,n=me.v,o=E(t)?b(t):0;return n?r>=n:o<J.v}),[V,me,ge,J],"isLastPage"),Ee=async()=>{const e=te(V.v);e&&await t.setCache(e.entity,(e=>{if(e){const t=oe(e)||[];return w(t,0,b(t),...Y.v),e}}))};ue((({method:e,data:t})=>{const r=te(V.v);if(r&&z(r.entity)===z(e)){const e=oe(t);if(P){const t=Y.v,r=J.v,n=b(t)%r;if(n>0){const t=[...Y.v];w(t,(V.v-1)*r,n,...e),Y.v=t}}else Y.v=e}}));const xe=c(i),Re=c(i);ve.onSuccess((({data:e,args:[t,r],method:n})=>{const{total:o}=te(n)||{},s=e;Z.v=o!==i?o:C(s),r||((async e=>{const t=V.v-1,r=de(t);R&&await ye({rawData:e,preloadPage:t,fetchMethod:r})&&f(ie(r),j)})(s),we(s));const a=J.v,c=oe(s);if(nt(E(c),"Got wrong array, did you return the correct array of list in `data` function"),P){if(B.current&&(Y.v=[]),t===i)Y.v=[...Y.v,...c];else if(t){const e=[...Y.v];w(e,(t-1)*a,a,...c),Y.v=e}}else Y.v=c})).onSuccess((({data:e})=>{var t;null===(t=xe.current)||void 0===t||t.call(xe,e)})).onError((({error:e})=>{var t;null===(t=Re.current)||void 0===t||t.call(Re,e)})).onComplete((()=>{B.current=l}));const _e=e=>{const t=Y.v.indexOf(e);return nt(t>=0,"item is not found in list"),t},{addQueue:ke,onComplete:Ce}=c(X()).current,Me=async(t=V.v)=>{let r=t,n=o();if(P){if(!H(t)){const e=_e(t);r=Math.floor(e/J.v)+1}nt(r<=V.v,"refresh page can't greater than page"),n=pe(r,u)}else nt(H(r),"unable to calculate refresh page by item in pagination mode"),n=r===V.v?pe(i,u):ie(e(r,J.v),u);return n},Te=async(e=l)=>{const r=V.v,n=ee();let o=(a=n,s.values(a));var a;if(e)ne();else{const e=g(y([te(r-1),te(r),te(r+1)],Boolean),(({entity:e})=>z(e)));o=g(y(h(n),(t=>!k(e,t))),(e=>{const t=n[e];return delete n[e],t}))}await t.invalidateCache(g(o,(({entity:e})=>e)))},je=async()=>{le.current&&ce(),await Te();const e=te(V.v+1);if(e){const r=oe(await t.queryCache(e.entity)||{})||[];we(i,b(r)<J.v)}},Pe=e=>{if(0===e)return;const t=Z.v;if(H(t)){const r=Math.max(t+e,0);Z.v=r;const n=V.v;v([te(n-1),te(n),te(n+1)],(e=>{e&&(e.total=r)}))}},Oe=(e,r=0)=>(Ce(je),ke((async()=>{const n=H(r)?r:_e(r)+1;let o=i;const s=[...Y.v];if(b(s)%J.v==0&&(o=s.pop()),w(s,n,0,e),Y.v=s,Pe(1),await Ee(),o){const e=te(V.v+1);e&&await t.setCache(e.entity,(e=>{if(e){const t=oe(e)||[];return t.unshift(o),t.pop(),e}}))}}))),He=(...e)=>(Ce(je),ke((async()=>{const r=g(e,(e=>{const t=H(e)?e:_e(e);return ot(t,Y.v),t})),n=V.v,o=te(n+1),s=[];o&&await t.setCache(o.entity,(e=>{if(e){const t=oe(e);return E(t)&&p(s,...w(t,0,b(r))),e}}));const a=be.v,i=b(s);if(i>0||a){const e=y(Y.v,((e,t)=>!k(r,t)));!P&&a&&b(e)<=0?V.v=n-1:i>0&&p(e,...s),Y.v=e}else i<=0&&!a&&Me(n);return Pe(-b(r)),Ee()}))),qe=(e,t)=>ke((async()=>{nt(t!==i,"expect specify the replace position");const r=H(t)?t:_e(t);ot(r,Y.v);const n=[...Y.v];w(n,r,1,e),Y.v=n,await Ee()})),De=async()=>{await Te(u),B.current=u,V.v===q?f(pe(),j):V.v=q;const{resolve:e,reject:t,promise:r}=K();return xe.current=e,Re.current=t,r};return fe.current={refresh:Me,insert:Oe,remove:He,replace:qe,reload:De},m({...ve,...S([Y,V,me,J,Z,be]),fetching:se.loading,onFetchSuccess:se.onSuccess,onFetchError:se.onError,onFetchComplete:se.onComplete,refresh:Me,insert:Oe,remove:He,replace:qe,reload:De})},e.useRequest=tt,e.useRetriableRequest=(e,r={})=>{const{retry:s=3,backoff:a={delay:1e3},middleware:c=j}=r,{ref:d,exposeProvider:h,__referingObj:v}=Se(t.promiseStatesHook()),p=re(),g=d(0),y=d(i),S=d(i),w=d(i),b=d(l),E=d(i),x=d(K()),R=tt(e,{...r,__referingObj:v,middleware(e,t){c({...e,delegatingActions:{stop:_}},(()=>o()));const{proxyStates:r,args:d,send:h,method:v,controlLoading:R}=e;R();const{loading:k}=r,C=(e=l)=>{k.v=e},M=e=>{C(),r.error.v=e,clearTimeout(E.current),((e,t,r)=>{m((()=>{p.emit(pr,V(Ke,Te.spawn(e,t),r,g.current)),y.current=i,g.current=0}))})(v,d,e)};return k.v||f(x.current.promise,(e=>{M(e),x.current=K()})),C(u),b.current=u,S.current=v,w.current=d,t().then((e=>(C(),e)),(e=>{if(!y.current&&(H(s)?g.current<s:s(e,...d))){g.current+=1;const e=Z(a,g.current);E.current=m((()=>{p.emit(vr,V(Be,Te.spawn(v,d),g.current,e)),f(h(...d),j)}),e)}else e=y.current||e,M(e);return t=e,n.reject(t);var t})).finally((()=>{b.current=l}))}}),_=()=>{yr(R.__proxyState("loading").v,"there is no requests being retried"),y.current=V(ee,gr,"stop retry manually"),b.current?R.abort():x.current.reject(y.current)};return h({...R,stop:_,onRetry:e=>{p.on(vr,(t=>e(t)))},onFail:e=>{p.on(pr,(t=>e(t)))}})},e.useSQRequest=function(e,r={}){const{exposeProvider:n,__referingObj:o}=Se(t.promiseStatesHook()),{middleware:s=j}=r,{c:a,m:i,b:c,d:u}=ar(e,r),l=tt(a,{...r,__referingObj:o,middleware:(e,t)=>{const r=i(e,t);return s(e,(()=>r)),r}});return u(l),n({...l,...c})},e.useSSE=(e,r={})=>{const{initialData:n,withCredentials:o,interceptByGlobalResponded:s=u,immediate:a=l}=r,c=u;let{memorize:f}=t.promiseStatesHook();null!=f||(f=P);const{create:m,ref:p,onMounted:S,onUnmounted:w,objectify:b,exposeProvider:E}=Se(t.promiseStatesHook()),x=p([]),R=p(i),_=p(i),k=m(n,"data"),C=m(Er.CLOSED,"readyState");let M,T=ge(e);const H=re(),q=p(new Map),D=p(P),F=p(ve),U=p(j),A=e=>{const{responded:t}=(e=>Q(e).options)(e);if(M=t,O(M))D.current=M;else if(M&&L(M)){const{onSuccess:e,onError:t,onComplete:r}=M;D.current=O(e)?e:D.current,F.current=O(t)?t:F.current,U.current=O(r)?r:U.current}},N=async e=>{const{headers:r,transform:n=P}=$(T),o=await e,s=await n(o,r||{});return k.v=s,t.hitCacheBySource(T),s},z=async(e,t)=>{xr(!!R.current,"EventSource is not initialized");const r=R.current,n=new He(Te.spawn(T,x.current),r);if(e===Rr)return Promise.resolve(n);const o=s?D.current:P,a=s?F.current:ve,i=s?U.current:j,c=(u=d(t,(e=>N(o(e,T))),(e=>N(a(e,T)))),l=()=>{i(T)},u.finally(l));var u,l;return d(c,(e=>new De(n,e)),(e=>new qe(n,e)))},W=e=>t=>t.error===i?e(t):H.emit(br,t),G=f((()=>{var e;C.v=Er.OPEN,d(z(Rr,Promise.resolve()),(e=>H.emit(Sr,e))),null===(e=_.current)||void 0===e||e.resolve()})),B=f((e=>{var t,r;C.v=Er.CLOSED,d(z(_r,Promise.reject(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"SSE Error")),W((e=>H.emit(wr,e)))),null===(r=_.current)||void 0===r||r.resolve()})),I=f((e=>{d(z(kr,Promise.resolve(e.data)),W((e=>H.emit(wr,e))))})),V=()=>{const e=R.current;e&&(_.current&&_.current.resolve(),e.close(),e.removeEventListener(Rr,G),e.removeEventListener(_r,B),e.removeEventListener(kr,I),C.v=Er.CLOSED,q.current.forEach((([t,r],n)=>{e.removeEventListener(n,r)})))},J=(...t)=>{let r=R.current,n=_.current;r&&c&&V(),n||(n=_.current=K(),n&&n.promise.finally((()=>{n=i}))),x.current=t,T=ge(e,t),A(T);const{params:s}=$(T),{baseURL:a,url:u}=T,l=((e,t,r)=>{e=e.endsWith("/")?e.slice(0,-1):e,""!==t&&(t=t.match(/^(\/|https?:\/\/)/)?t:`/${t}`);const n=e+t,o=g(y(h(r),(e=>r[e]!==i)),(e=>`${e}=${r[e]}`)).join("&");return o?+n.includes("?")?`${n}&${o}`:`${n}?${o}`:n})(a,u,s);return r=new EventSource(l,{withCredentials:o}),R.current=r,C.v=Er.CONNECTING,r.addEventListener(Rr,G),r.addEventListener(_r,B),r.addEventListener(kr,I),q.current.forEach((([e,t],n)=>{null==r||r.addEventListener(n,(e=>{d(z(n,Promise.resolve(e.data)),W(t))}))})),n.promise};return w((()=>{V(),H.off(Sr),H.off(wr),H.off(br),q.current.forEach((([e,t,r])=>{r()}))})),S((()=>{var e;a&&(J(),null===(e=_.current)||void 0===e||e.promise.catch((()=>{})))})),E({send:J,close:V,on:(e,t)=>{var r;const n=q.current;if(!n.has(e)){const t=function(e=j){let t=[];return[r=>(t.includes(r)||(t.push(r),e(t)),()=>{t=y(t,(e=>e!==r)),e(t)}),(...e)=>{if(t.length>0)return v(t,(t=>t(...e)))},()=>{t=[],e(t)}]}((r=>{var n;0===r.length&&(null===(n=R.current)||void 0===n||n.removeEventListener(e,t[1]),q.current.delete(e))})),o=t[1];n.set(e,t),null===(r=R.current)||void 0===r||r.addEventListener(e,(t=>{d(z(e,Promise.resolve(t.data)),W(o))}))}const[o]=n.get(e);return o(t)},onMessage:e=>{H.on(wr,e)},onError:e=>{H.on(br,e)},onOpen:e=>{H.on(Sr,e)},eventSource:R,...b([C,k])})},e.useSerialRequest=(e,r={})=>{st("useSerialRequest",e);const{ref:n,__referingObj:o}=Se(t.promiseStatesHook()),s=n([]).current,a=tt(e[0],{...r,__referingObj:o,middleware:at(e,r.middleware,s)});return a.onError=ne(a.onError,((e,t)=>{t.method=s[b(s)-1],e(t)})),a},e.useSerialWatcher=(e,r,n={})=>{st("useSerialWatcher",e);const{ref:o,__referingObj:s}=Se(t.promiseStatesHook()),a=o([]).current,i=rt(e[0],r,{...n,__referingObj:s,middleware:at(e,n.middleware,a)});return i.onError=ne(i.onError,((e,t)=>{t.method=a[b(a)-1],e(t)})),i},e.useWatcher=rt}));
